<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacation Days Calculator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2376B900'/%3E%3Ctext x='50' y='72' font-family='Arial, Helvetica, sans-serif' font-size='65' font-weight='900' fill='white' text-anchor='middle'%3EV%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'NVIDIA Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #76B900;
            margin-bottom: 30px;
            background: linear-gradient(180deg, #242424 0%, #1a1a1a 100%);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .nvidia-logo {
            width: 60px;
            height: 60px;
            flex-shrink: 0;
        }

        .header-text {
            text-align: left;
        }

        h1 {
            color: #76B900;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #999;
            font-size: 1.1em;
        }

        .section {
            background: #242424;
            border-radius: 4px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #333;
        }

        .section h2 {
            color: #76B900;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 2px solid #76B900;
            padding-bottom: 8px;
            font-weight: 600;
        }

        .section h3 {
            color: #9be500;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-group label {
            flex: 0 0 320px;
            text-align: left;
            color: #aaa;
            font-weight: 500;
        }

        .label-select {
            background: transparent;
            border: none;
            color: #aaa;
            font-weight: 500;
            font-size: 1em;
            font-family: inherit;
            cursor: pointer;
            padding: 0;
            margin: 0;
            appearance: auto;
            width: 250px;
        }

        .label-select:focus {
            outline: none;
            color: #aaa;
        }

        .label-select option {
            background: #242424;
            color: #e0e0e0;
        }

        .form-group input[type="number"],
        .form-group select:not(.label-select) {
            flex: 1;
            max-width: 200px;
            padding: 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #1a1a1a;
            color: #e0e0e0;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: #76B900;
            box-shadow: 0 0 0 3px rgba(118, 185, 0, 0.2);
        }

        .form-group input[type="number"]::placeholder {
            color: #666;
        }

        /* Hide number input spinners */
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .form-group input[type="number"] {
            -moz-appearance: textfield;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #76B900;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: #e0e0e0;
        }

        .radio-group input[type="radio"] {
            accent-color: #76B900;
        }

        .btn {
            padding: 14px 35px;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #76B900;
            color: #000;
            box-shadow: 0 4px 15px rgba(118, 185, 0, 0.3);
        }

        .btn-primary:hover {
            background: #8ed100;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 185, 0, 0.4);
        }

        .btn-container {
            text-align: center;
            margin-top: 25px;
        }

        .output-section {
            display: none;
        }

        .output-section.visible {
            display: block;
        }

        .output-box {
            background: #1a1a1a;
            border-radius: 4px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            border-left: 4px solid #76B900;
            overflow-x: auto;
        }

        .results-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .result-card {
            background: #1a1a1a;
            border-radius: 4px;
            padding: 15px;
            border: 1px solid #333;
        }

        .result-card.highlight {
            background: rgba(118, 185, 0, 0.1);
            border-color: #76B900;
        }

        .result-card.warning {
            background: rgba(255, 82, 82, 0.1);
            border-color: #ff5252;
        }

        .result-card.success {
            background: rgba(118, 185, 0, 0.15);
            border-color: #76B900;
        }

        .result-card.neutral {
            background: #000;
            border-color: #fff;
        }

        .result-card.neutral .result-label {
            color: #ccc;
        }

        .result-card.neutral .result-value {
            color: #fff;
        }

        .result-label {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .result-value {
            color: #e0e0e0;
            font-size: 1.4em;
            font-weight: bold;
        }

        .result-card.highlight .result-value {
            color: #76B900;
        }

        .result-card.warning .result-value {
            color: #ff5252;
        }

        .result-card.success .result-value {
            color: #76B900;
        }

        .results-divider {
            grid-column: 1 / -1;
            border-top: 1px solid #333;
            margin: 5px 0;
        }

        .results-row {
            display: flex;
            gap: 15px;
        }

        .results-row .result-card {
            flex: 1;
        }

        .error-message {
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid #ff5252;
            border-radius: 4px;
            padding: 15px;
            color: #ff5252;
            margin-top: 15px;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .error-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .error-table th,
        .error-table td {
            padding: 8px 12px;
            text-align: center;
            border: 1px solid #ff5252;
        }

        .error-table th {
            background: rgba(255, 82, 82, 0.2);
            font-weight: 600;
        }

        .error-table td {
            background: rgba(0, 0, 0, 0.2);
        }

        .usage-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .usage-table th,
        .usage-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        .usage-table th {
            background: rgba(118, 185, 0, 0.1);
            color: #76B900;
            font-weight: 600;
        }

        .usage-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #9be500;
        }

        a {
            color: #5cb8ff;
            text-decoration: none;
        }

        a:hover {
            color: #8dd0ff;
            text-decoration: underline;
        }

        .note {
            background: rgba(118, 185, 0, 0.1);
            border-left: 3px solid #76B900;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 4px 4px 0;
        }

        .payslip-image {
            margin: 20px 0;
            text-align: center;
        }

        .payslip-image img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #444;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        li {
            margin-bottom: 6px;
        }

        .constants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .constant-item {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #333;
        }

        .constant-name {
            color: #9be500;
            font-size: 0.85em;
            font-weight: 500;
        }

        .constant-value {
            color: #76B900;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #333;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <svg class="nvidia-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- NVIDIA Eye Logo -->
                    <path fill="#76B900" d="M37.4 38.2c-0.8 0.1-1.6 0.2-2.4 0.4v-6c0.8-0.1 1.6-0.2 2.4-0.3v5.9zm-8.8 2.2c-0.8 0.2-1.6 0.4-2.4 0.7v-6.2c0.8-0.2 1.6-0.4 2.4-0.6v6.1zm-8.4 3.6c-0.8 0.3-1.6 0.7-2.4 1.1v-6.5c0.8-0.4 1.6-0.7 2.4-1v6.4zm17.2 4.4c-0.8 0.1-1.6 0.1-2.4 0.2v-6c0.8-0.1 1.6-0.1 2.4-0.2v6zm-8.8 1.6c-0.8 0.2-1.6 0.4-2.4 0.5v-6.1c0.8-0.2 1.6-0.3 2.4-0.5v6.1zm-8.4 2.8c-0.8 0.3-1.6 0.6-2.4 0.9v-6.3c0.8-0.3 1.6-0.6 2.4-0.8v6.2zm17.2 4.4c-0.8 0-1.6 0.1-2.4 0.1v-6c0.8 0 1.6-0.1 2.4-0.1v6zm-8.8 1.2c-0.8 0.1-1.6 0.3-2.4 0.5v-6c0.8-0.2 1.6-0.3 2.4-0.4v5.9zm-8.4 2.4c-0.8 0.2-1.6 0.5-2.4 0.8v-6.2c0.8-0.3 1.6-0.5 2.4-0.8v6.2z"/>
                    <path fill="#76B900" d="M78.6 47.8c-2.7-0.9-5.5-1.6-8.4-1.9v-9.3c3.9 0.4 7.6 1.4 11.2 2.7l-2.8 8.5zm-15.4-2.6c-2.8-0.2-5.6-0.2-8.4 0v-9.2c2.8-0.2 5.6-0.2 8.4 0v9.2zm-15.4 1.2c-2.8 0.3-5.6 0.9-8.4 1.7v-9.4c2.7-0.7 5.5-1.2 8.4-1.6v9.3z"/>
                    <path fill="#76B900" d="M78.6 64.4c-2.7-0.7-5.5-1.1-8.4-1.3v-9.2c3.6 0.3 7.1 1 10.3 2l-1.9 8.5zm-15.4-1.8c-2.8-0.1-5.6-0.1-8.4 0.1v-9.2c2.8-0.2 5.6-0.2 8.4-0.1v9.2zm-15.4 1.4c-2.8 0.3-5.6 0.8-8.4 1.5v-9.3c2.7-0.6 5.5-1 8.4-1.3v9.1z"/>
                    <path fill="#76B900" d="M78.6 80.9c-2.7-0.6-5.5-0.9-8.4-1v-9.2c3.4 0.2 6.6 0.7 9.8 1.5l-1.4 8.7zm-15.4-1.2c-2.8 0-5.6 0-8.4 0.2v-9.2c2.8-0.2 5.6-0.2 8.4-0.1v9.1zm-15.4 1.5c-2.8 0.3-5.6 0.7-8.4 1.2v-9.2c2.7-0.6 5.5-0.9 8.4-1.2v9.2z"/>
                    <path fill="#76B900" d="M86.8 89.4c-22.1-7.7-46.3-6.5-67.5 3.4l-5.2-7.8c24.1-11.2 51.6-12.4 76.7-3.5l-4 7.9z"/>
                </svg>
                <div class="header-text">
                    <h1>Vacation Days Calculator</h1>
                    <p class="subtitle">Calculate your expected vacation days credit at year end</p>
                </div>
            </div>
        </header>

        <!-- Usage Section -->
        <div class="section">
            <h2>Usage</h2>
            <p>This tool calculates the number of vacation days credit you are expected to have at the end of the year.</p>
            <br>
            <p>The calculation is based on your <strong>Annual Allowance (מכסה שנתית)</strong> and <strong>Current Accumulation (יתרה חדשה)</strong> as they appear in your latest pay slip (<span id="paySlipMonth1"></span>). For example:</p>
            
            <div class="payslip-image">
                <img src="payslip_example.png" alt="Pay slip example showing Annual Allowance (מכסה שנתית) and New Balance (יתרה חדשה)">
            </div>
            
            <p>It also depends on your maximum allowed accumulation and should take into account any extra vacation consumed or planned which is not reflected in your latest pay slip (<span id="paySlipMonth2"></span>).</p>
            
            <p>Such vacation consists of:</p>
            <ul>
                <li>Any vacation days taken during the previous month (<span id="prevMonthName"></span>)</li>
                <li>Any vacation days taken during the current month (<span id="currMonthName"></span>) up to and including today</li>
                <li>Any planned vacation days expected to be taken from now on until the end of the year</li>
            </ul>

            <br>
            <p>In some cases, you may be entitled to accumulate more than the standard 36 days by the end of the year. Check <a href="https://www.kolzchut.org.il/he/%D7%A6%D7%91%D7%99%D7%A8%D7%AA_%D7%99%D7%9E%D7%99_%D7%97%D7%95%D7%A4%D7%A9%D7%94_%D7%9C%D7%A2%D7%95%D7%91%D7%93%D7%99%D7%9D_%D7%A9%D7%9C%D7%90_%D7%99%D7%9B%D7%9C%D7%95_%D7%9C%D7%A0%D7%A6%D7%9C_%D7%90%D7%AA_%D7%94%D7%99%D7%9E%D7%99%D7%9D_%D7%91%D7%92%D7%9C%D7%9C_%D7%9E%D7%9C%D7%97%D7%9E%D7%AA_%D7%97%D7%A8%D7%91%D7%95%D7%AA_%D7%91%D7%A8%D7%96%D7%9C_%D7%90%D7%95_%D7%94%D7%9E%D7%9C%D7%97%D7%9E%D7%94_%D7%9E%D7%95%D7%9C_%D7%90%D7%99%D7%A8%D7%90%D7%9F_(%D7%9E%D7%9C%D7%97%D7%9E%D7%AA_%D7%94%D7%AA%D7%A7%D7%95%D7%9E%D7%94)" target="_blank">here</a> to see if you meet the criteria for extra accumulation days. If indeed you're entitled to extra accumulation days, set the Non Standard Accumulation Allowance checkbox, and don't forget to update the <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=FT0IQ3NywUC32znv2czBekylSr-AHgVLkfCft-h2OjhUMlZUTUJYWVNZS05BNTFFMVdHV1lPUFdXVy4u&lang=he-IL" target="_blank">payroll team</a>.</p>

            <br>
            <p>The latest pay slip is available on the <a href="https://nvidia.net.hilan.co.il/login" target="_blank">Hilan site</a> (make sure to update your attendance).</p>

            <p>A single workday is evaluated as <strong>8.4 hours</strong>.</p>
        </div>

        <!-- Calculator Section -->
        <div class="section">
            <h2>Calculator</h2>
            <form id="calculatorForm">
                <h3><span id="paySlipMonth"></span> Pay Slip Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>
                            <select id="annualType" name="annualType" class="label-select">
                                <option value="hours" selected>Annual Vacation Hours *</option>
                                <option value="days">Annual Vacation Days *</option>
                            </select>
                        </label>
                        <input type="number" id="annualValue" name="annualValue" placeholder="Annual allowance" min="126" max="202" step="1" required>
                    </div>
                    <div class="form-group">
                        <label for="currentHours">Current Accumulated Hours *</label>
                        <input type="number" id="currentHours" name="currentHours" placeholder="Current accumulation" step="0.01" required>
                    </div>
                </div>

                <h3>Vacation days not reflected in the <span id="notReflectedMonth"></span> pay slip</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="prevMonthVacation"><span id="prevMonthLabel"></span> vacation days</label>
                        <input type="number" id="prevMonthVacation" name="prevMonthVacation" value="0" min="0" max="31" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="currMonthVacation"><span id="currMonthLabel"></span> vacation days (up to today)</label>
                        <input type="number" id="currMonthVacation" name="currMonthVacation" value="0" min="0" max="31" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="plannedVacation">Planned vacation days (rest of year)</label>
                        <input type="number" id="plannedVacation" name="plannedVacation" value="0" min="0" max="365" step="0.01">
                    </div>
                </div>

                <br>
                <div class="checkbox-group" style="margin-top: 15px;">
                    <label for="specialCase" class="checkbox-label">
                        <input type="checkbox" id="specialCase" name="specialCase">
                        Non Standard Accumulation Allowance
                    </label>
                </div>
            </form>
            <div id="errorMessage" class="error-message"></div>
        </div>

        <!-- Output Section -->
        <div id="outputSection" class="section output-section">
            <h2>Results</h2>
            <div id="outputContent" class="results-content"></div>
        </div>

        <footer>
            <p>Vacation Days Calculator &copy; 2025</p>
        </footer>
    </div>

    <script>
        // Constants
        const WORK_DAY_HOURS = 8.4;
        const MONTHS_PER_YEAR = 12;
        const MIN_ANNUAL_DAYS = 15;
        const MAX_ANNUAL_DAYS = 24;
        const MIN_MAX_ACCUM_DAYS = 36;
        const MAX_MAX_ACCUM_DAYS = 48;

        // Valid annual vacation options
        const VALID_ANNUAL_DAYS = [15, 16, 17, 18, 19, 20, 21, 22, 23, 24];
        const VALID_ANNUAL_HOURS = [126, 135, 143, 152, 159, 168, 177, 185, 194, 202];

        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // Helper functions
        function hoursToDays(hours) {
            return hours / WORK_DAY_HOURS;
        }

        function daysToHours(days) {
            return days * WORK_DAY_HOURS;
        }

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function daysInMonth(month, year) {
            const days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (month === 2 && isLeapYear(year)) return 29;
            return days[month - 1];
        }

        function dayOfWeek(day, month, year) {
            // Zeller's congruence
            let m = month;
            let y = year;
            if (m < 3) {
                m += 12;
                y--;
            }
            const q = day;
            const k = y % 100;
            const j = Math.floor(y / 100);
            let h = (q + Math.floor((13 * (m + 1)) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) - 2 * j) % 7;
            return ((h + 6) % 7);
        }

        function calculateWorkingDays(month, year, weekStartSunday) {
            const totalDays = daysInMonth(month, year);
            let workingDays = 0;

            for (let day = 1; day <= totalDays; day++) {
                const dow = dayOfWeek(day, month, year);
                let isWorking;
                if (weekStartSunday) {
                    // Working days: Sun(0) - Thu(4)
                    isWorking = (dow >= 0 && dow <= 4);
                } else {
                    // Working days: Mon(1) - Fri(5)
                    isWorking = (dow >= 1 && dow <= 5);
                }
                if (isWorking) workingDays++;
            }
            return workingDays;
        }

        function calculateRemainingWorkingDays(currentMonth, year, weekStartSunday) {
            let totalWorkingDays = 0;
            for (let month = currentMonth; month <= 12; month++) {
                totalWorkingDays += calculateWorkingDays(month, year, weekStartSunday);
            }
            return totalWorkingDays;
        }

        function calculateWorkingDaysFromPrevMonth(currentMonth, year, weekStartSunday) {
            let totalWorkingDays = 0;
            let startMonth;

            // Previous month (handle January wrapping to December of previous year)
            if (currentMonth === 1) {
                // Add December of previous year
                totalWorkingDays += calculateWorkingDays(12, year - 1, weekStartSunday);
                startMonth = 1;
            } else {
                startMonth = currentMonth - 1;
            }

            // Add working days from startMonth to end of year
            for (let month = startMonth; month <= 12; month++) {
                totalWorkingDays += calculateWorkingDays(month, year, weekStartSunday);
            }

            return totalWorkingDays;
        }

        function calculateRemainingMonths(month) {
            return MONTHS_PER_YEAR - month + 1;
        }

        function calculateMaxAccum(annualDays, specialCase) {
            // Normal case: always 36
            if (!specialCase) {
                return MIN_MAX_ACCUM_DAYS;
            }
            // Special case: 15-17 days -> 36, 18-24 days -> annual_days * 2
            if (annualDays < 18) {
                return MIN_MAX_ACCUM_DAYS;
            }
            return annualDays * 2;
        }

        function isValidAnnualDays(days) {
            return VALID_ANNUAL_DAYS.includes(days);
        }

        function isValidAnnualHours(hours) {
            return VALID_ANNUAL_HOURS.includes(hours);
        }

        function hoursToAnnualDays(hours) {
            const index = VALID_ANNUAL_HOURS.indexOf(hours);
            return index !== -1 ? VALID_ANNUAL_DAYS[index] : null;
        }

        function getValidOptionsMessage(invalidValue, isHours) {
            const unit = isHours ? 'hours' : 'days';
            let html = `<strong>Invalid annual vacation ${unit} (${invalidValue}).</strong><br><br>`;
            html += `<strong>Valid annual vacation options:</strong>`;
            html += `<table class="error-table">`;
            html += `<tr><th>Days</th><th>Hours</th></tr>`;
            for (let i = 0; i < VALID_ANNUAL_DAYS.length; i++) {
                html += `<tr><td>${VALID_ANNUAL_DAYS[i]}</td><td>${VALID_ANNUAL_HOURS[i]}</td></tr>`;
            }
            html += `</table>`;
            html += `Please consult your pay slip for your annual vacation allowance.`;
            return html;
        }

        function showError(message, isHtml = false) {
            const errorDiv = document.getElementById('errorMessage');
            if (isHtml) {
                errorDiv.innerHTML = message;
            } else {
                errorDiv.textContent = message;
            }
            errorDiv.classList.add('visible');
            document.getElementById('outputSection').classList.remove('visible');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('visible');
        }

        function formatNumber(value) {
            const rounded = Math.round(value);
            if (Math.abs(value - rounded) < 0.005) {
                return rounded.toString();
            }
            // Remove trailing zeros
            return parseFloat(value.toFixed(2)).toString();
        }

        function formatDays(value) {
            return formatNumber(value);
        }

        function formatHours(value) {
            return formatNumber(value);
        }

        function calculate(annualDays, maxAccumDays, currentHours, vacationPlanned, weekStartSunday) {
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();

            // Calculate working days from start of previous month to end of year
            const maxWorkingDays = calculateWorkingDaysFromPrevMonth(currentMonth, currentYear, weekStartSunday);

            // Validate vacation days
            if (vacationPlanned < 0) {
                throw new Error("Extra vacation days consumption cannot be negative.");
            }
            if (vacationPlanned > maxWorkingDays) {
                throw new Error(`Extra vacation days consumption (${vacationPlanned}) cannot exceed working days from start of previous month (${maxWorkingDays}).`);
            }

            // Calculate remaining months
            const remainingMonths = calculateRemainingMonths(currentMonth);

            // Calculate monthly hours
            const monthlyHours = daysToHours(annualDays) / MONTHS_PER_YEAR;

            // Calculate additional hours/days
            const additionalHours = remainingMonths * monthlyHours;
            const additionalDays = hoursToDays(additionalHours);

            // Calculate total hours (minus vacation planned)
            let totalHours = currentHours + additionalHours;
            totalHours -= daysToHours(vacationPlanned);

            // Calculate total days (no rounding)
            const totalDays = hoursToDays(totalHours);

            // Calculate excess
            const excessDays = Math.max(0, totalDays - maxAccumDays);
            const excessHours = daysToHours(excessDays);
            const maxAccumHours = daysToHours(maxAccumDays);

            return {
                maxAccumDays,
                maxAccumHours,
                additionalDays,
                additionalHours,
                totalHours,
                totalDays,
                excessDays,
                excessHours
            };
        }

        function displayResults(results) {
            const output = document.getElementById('outputContent');
            let html = '';

            // First row: Maximum allowed accumulation and Additional vacation credit
            html += `<div class="results-row">`;
            
            // Maximum allowed accumulation
            const maxAccumValue = `${formatHours(results.maxAccumHours)} hours / ${results.maxAccumDays} days`;
            html += `<div class="result-card neutral">
                <div class="result-label">Maximum allowed accumulation</div>
                <div class="result-value">${maxAccumValue}</div>
            </div>`;

            // Additional vacation credit
            const currentYear = new Date().getFullYear();
            const additionalValue = `${formatHours(results.additionalHours)} hours / ${formatDays(results.additionalDays)} days`;
            html += `<div class="result-card neutral">
                <div class="result-label">Additional vacation credit due in ${currentYear}</div>
                <div class="result-value">${additionalValue}</div>
            </div>`;
            
            html += `</div>`;

            // Second row: Accumulated vacation at end of year and Vacation to be deducted
            const accumulatedValue = `${formatHours(results.totalHours)} hours / ${formatDays(results.totalDays)} days`;
            html += `<div class="results-row">`;
            if (results.totalDays > results.maxAccumDays) {
                html += `<div class="result-card warning">
                    <div class="result-label">Accumulated vacation at the end of ${currentYear}</div>
                    <div class="result-value">${accumulatedValue}</div>
                </div>`;
            } else {
                html += `<div class="result-card success">
                    <div class="result-label">Accumulated vacation at the end of ${currentYear}</div>
                    <div class="result-value">${accumulatedValue}</div>
                </div>`;
            }
            
            const excessValue = `${formatHours(results.excessHours)} hours / ${formatDays(results.excessDays)} days`;
            if (results.excessDays > 0) {
                html += `<div class="result-card warning">
                    <div class="result-label">Vacation to be deducted at the end of ${currentYear}</div>
                    <div class="result-value">${excessValue}</div>
                </div>`;
            } else {
                html += `<div class="result-card success">
                    <div class="result-label">Vacation to be deducted at the end of ${currentYear}</div>
                    <div class="result-value">0 hours / 0 days</div>
                </div>`;
            }
            html += `</div>`;

            output.innerHTML = html;
            document.getElementById('outputSection').classList.add('visible');
        }

        // Annual type toggle handler - convert between days and hours
        document.getElementById('annualType').addEventListener('change', function(e) {
            const annualValueInput = document.getElementById('annualValue');
            const currentValueStr = annualValueInput.value;
            
            // Update min/max regardless of value
            if (e.target.value === 'hours') {
                annualValueInput.step = "1";
                annualValueInput.min = VALID_ANNUAL_HOURS[0];
                annualValueInput.max = VALID_ANNUAL_HOURS[VALID_ANNUAL_HOURS.length - 1];
                annualValueInput.placeholder = "Annual allowance";
            } else {
                annualValueInput.step = "1";
                annualValueInput.min = VALID_ANNUAL_DAYS[0];
                annualValueInput.max = VALID_ANNUAL_DAYS[VALID_ANNUAL_DAYS.length - 1];
                annualValueInput.placeholder = "Annual allowance";
            }
            
            // Only convert if there's a value
            if (currentValueStr !== '') {
                const currentValue = parseInt(currentValueStr) || 0;
                if (e.target.value === 'hours') {
                    // Converting from days to hours - find corresponding hours
                    const dayIndex = VALID_ANNUAL_DAYS.indexOf(currentValue);
                    if (dayIndex !== -1) {
                        annualValueInput.value = VALID_ANNUAL_HOURS[dayIndex];
                    } else {
                        annualValueInput.value = '';
                    }
                } else {
                    // Converting from hours to days - find corresponding days
                    const hourIndex = VALID_ANNUAL_HOURS.indexOf(currentValue);
                    if (hourIndex !== -1) {
                        annualValueInput.value = VALID_ANNUAL_DAYS[hourIndex];
                    } else {
                        annualValueInput.value = '';
                    }
                }
            }
            
            // Trigger calculation after conversion
            performCalculation();
        });

        // Auto-calculation function
        function performCalculation() {
            hideError();

            const annualType = document.getElementById('annualType').value;
            const annualValue = parseFloat(document.getElementById('annualValue').value);
            const specialCase = document.getElementById('specialCase').checked;
            const currentHours = parseFloat(document.getElementById('currentHours').value);
            const prevMonthInput = document.getElementById('prevMonthVacation');
            const currMonthInput = document.getElementById('currMonthVacation');
            const plannedInput = document.getElementById('plannedVacation');
            
            // Fill empty fields with 0
            if (prevMonthInput.value === '') prevMonthInput.value = '0';
            if (currMonthInput.value === '') currMonthInput.value = '0';
            if (plannedInput.value === '') plannedInput.value = '0';
            
            const prevMonthVacation = parseFloat(prevMonthInput.value) || 0;
            const currMonthVacation = parseFloat(currMonthInput.value) || 0;
            const plannedVacation = parseFloat(plannedInput.value) || 0;
            const vacationDays = prevMonthVacation + currMonthVacation + plannedVacation;
            const weekStartSunday = true; // Default: Sunday start (Sun-Thu working)

            // Validate inputs - only proceed if required fields are filled
            if (isNaN(annualValue) || annualValue < 1) {
                // Don't show error, just don't calculate
                return;
            }

            if (isNaN(currentHours)) {
                // Don't show error, just don't calculate
                return;
            }

            // Validate vacation days fields
            if (prevMonthVacation < 0 || currMonthVacation < 0 || plannedVacation < 0) {
                showError("Vacation days cannot be negative.");
                return;
            }

            // Convert hours to days if needed and validate against valid options
            let annualDays;
            if (annualType === 'hours') {
                if (!Number.isInteger(annualValue)) {
                    showError("Annual vacation hours must be an integer.");
                    return;
                }
                if (!isValidAnnualHours(annualValue)) {
                    showError(getValidOptionsMessage(annualValue, true), true);
                    return;
                }
                annualDays = hoursToAnnualDays(annualValue);
            } else {
                if (!Number.isInteger(annualValue)) {
                    showError("Annual vacation days must be an integer.");
                    return;
                }
                if (!isValidAnnualDays(annualValue)) {
                    showError(getValidOptionsMessage(annualValue, false), true);
                    return;
                }
                annualDays = annualValue;
            }

            // Calculate max accumulated days based on special case
            const maxAccum = calculateMaxAccum(annualDays, specialCase);

            try {
                const results = calculate(annualDays, maxAccum, currentHours, vacationDays, weekStartSunday);
                displayResults(results);
            } catch (error) {
                showError(error.message);
            }
        }

        // Add event listeners to all inputs and checkbox for auto-calculation
        document.getElementById('annualValue').addEventListener('input', performCalculation);
        document.getElementById('currentHours').addEventListener('input', performCalculation);
        document.getElementById('prevMonthVacation').addEventListener('input', performCalculation);
        document.getElementById('currMonthVacation').addEventListener('input', performCalculation);
        document.getElementById('plannedVacation').addEventListener('input', performCalculation);
        document.getElementById('specialCase').addEventListener('change', performCalculation);

        // Prevent form submission (no longer needed)
        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });

        // Populate month names on page load
        (function() {
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-11
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            
            document.getElementById('currMonthName').textContent = monthNames[currentMonth];
            document.getElementById('prevMonthName').textContent = monthNames[prevMonth];
            document.getElementById('currMonthLabel').textContent = monthNames[currentMonth];
            document.getElementById('prevMonthLabel').textContent = monthNames[prevMonth];
            document.getElementById('paySlipMonth').textContent = monthNames[prevMonth];
            document.getElementById('paySlipMonth1').textContent = monthNames[prevMonth];
            document.getElementById('paySlipMonth2').textContent = monthNames[prevMonth];
            document.getElementById('notReflectedMonth').textContent = monthNames[prevMonth];
        })();
    </script>
</body>
</html>


